<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Turf Booking System</title>
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Turf Admin">
    <meta name="msapplication-TileColor" content="#3498db">
    <meta name="description" content="Admin panel for turf booking management">
    

    <!-- Flatpickr for nice time/date pickers -->
  <link  rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- FullCalendar (calendar used inside Edit Turf) -->
  <link  href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/index.global.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.8/index.global.min.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">




    
    <style>
        /* Mobile Container - Hidden by default */


.container {
    width: 100vw;
    max-width: 375px;
    height: 100vh;
    max-height: 770px;
    margin: 0 auto;
    background: white;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    overflow-y: auto;
    position: relative;
    border-radius: 0;
}
/* Custom scrollbar for container */
.container::-webkit-scrollbar {
    width: 6px;
}

.container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.container::-webkit-scrollbar-thumb {
    background: rgba(102, 126, 234, 0.3);
    border-radius: 10px;
}

.container::-webkit-scrollbar-thumb:hover {
    background: rgba(102, 126, 234, 0.5);
}


/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    background-color: #f5f5f5;
    color: #333;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    overflow-y: auto;
    padding: 10px 0;
}

.modal-content {
    background-color: #fff;
    margin: 10px auto;
    padding: 20px;
    border-radius: 10px;
    width: 95%;
    max-width: 350px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-content h2 {
    margin-bottom: 15px;
    color: #2c3e50;
    text-align: center;
    font-size: 18px;
}

.modal-content input,
.modal-content textarea {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}

.modal-content button {
    width: 100%;
    padding: 10px;
    background-color: #3498db;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    margin-top: 8px;
}

.modal-content button:hover {
    background-color: #2980b9;
}

.close {
    color: #aaa;
    float: right;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    position: absolute;
    right: 15px;
    top: 10px;
}

.close:hover {
    color: #000;
}

/* Dashboard */
.dashboard {
    display: none;
    padding: 15px 10px;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.header h1 {
    color: #2c3e50;
    font-size: 18px;
    width: 100%;
    text-align: center;
    margin-bottom: 10px;
}

.admin-info {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    justify-content: center;
}

.admin-info span {
    font-weight: bold;
    color: #3498db;
    font-size: 13px;
}

.admin-info button {
    padding: 6px 12px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.admin-info button:hover {
    background-color: #c0392b;
}

/* Navigation Tabs */
.nav-tabs {
    display: flex;
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 15px;
    flex-direction: column;
}

.nav-tab {
    flex: 1;
    padding: 12px 15px;
    text-align: center;
    background-color: #ecf0f1;
    cursor: pointer;
    border-bottom: 1px solid #bdc3c7;
    transition: background-color 0.3s;
    font-size: 13px;
}

.nav-tab:last-child {
    border-bottom: none;
}

.nav-tab.active {
    background-color: #3498db;
    color: white;
}

.nav-tab:hover:not(.active) {
    background-color: #d5dbdb;
}

/* Tab Content */
.tab-content {
    display: none;
    background-color: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.tab-content.active {
    display: block;
}

.tab-content h2 {
    margin-bottom: 15px;
    color: #2c3e50;
    font-size: 16px;
}

/* Bookings Container */
.bookings-container {
    display: grid;
    gap: 15px;
}

.booking-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.booking-card.confirmed {
    border-left: 4px solid #27ae60;
}

.booking-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
    flex-wrap: wrap;
}

.booking-header h3 {
    color: #2c3e50;
    margin: 0;
    font-size: 16px;
}

.booking-id {
    background-color: #ecf0f1;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    color: #7f8c8d;
    margin-top: 5px;
}

.booking-details {
    margin-bottom: 12px;
}

.booking-details p {
    margin: 6px 0;
    line-height: 1.4;
    font-size: 13px;
}

.booking-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.booking-actions button {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    flex: 1;
    min-width: 80px;
}

.confirm-btn {
    background-color: #27ae60;
    color: white;
}

.confirm-btn:hover {
    background-color: #229954;
}

.reject-btn {
    background-color: #e74c3c;
    color: white;
}

.reject-btn:hover {
    background-color: #c0392b;
}

/* Turf Card */
.turf-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.turf-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
    flex-wrap: wrap;
}

.turf-header h3 {
    color: #2c3e50;
    margin: 0;
    font-size: 16px;
}

.turf-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.turf-actions button {
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 11px;
}

.turf-actions button:first-child {
    background-color: #f39c12;
    color: white;
}

.turf-actions button:first-child:hover {
    background-color: #d68910;
}

.delete-btn {
    background-color: #e74c3c;
    color: white;
}

.delete-btn:hover {
    background-color: #c0392b;
}

.turf-details p {
    margin: 6px 0;
    line-height: 1.4;
    font-size: 13px;
}

/* Add Turf Button */
#turfsTab button {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 15px;
    font-size: 14px;
    width: 100%;
}

#turfsTab button:hover {
    background-color: #2980b9;
}

/* Turf Form */
#turfForm {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

#turfForm label {
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
    font-size: 13px;
}

#turfForm input,
#turfForm textarea {
    padding: 10px 12px;
    border: 2px solid #e1e5e9;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.3s;
}

#turfForm input:focus,
#turfForm textarea:focus {
    outline: none;
    border-color: #667eea;
}

#turfForm button {
    padding: 12px;
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    margin-top: 10px;
}

#turfForm button:hover {
    transform: translateY(-1px);
}

#turfForm textarea {
    resize: vertical;
    min-height: 80px;
}

#turfModalTitle {
    margin-bottom: 20px;
    color: #333;
    text-align: center;
    margin-top: 0;
    font-size: 18px;
}

/* Loading and Error States */
.loading-spinner {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100px;
    flex-direction: column;
}

.spinner {
    width: 30px;
    height: 30px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    margin-top: 10px;
    color: #666;
    font-size: 14px;
}

.error-message {
    text-align: center;
    color: #e74c3c;
    background: #ffeaea;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    font-size: 14px;
}

.retry-btn {
    background: #3498db;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 8px;
    font-size: 12px;
}

/* Custom scrollbar */
.container::-webkit-scrollbar {
    width: 6px;
}

.container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.container::-webkit-scrollbar-thumb {
    background: rgba(52, 152, 219, 0.3);
    border-radius: 10px;
}

.container::-webkit-scrollbar-thumb:hover {
    background: rgba(52, 152, 219, 0.5);
}
.time-input-container {
    display: flex;
    gap: 8px;
    margin: 8px 0 15px 0;
}

.time-input-container select {
    flex: 1;
    padding: 10px;
    border: 2px solid #e1e5e9;
    border-radius: 6px;
    font-size: 14px;
    background: white;
}

.time-input-container select:focus {
    outline: none;
    border-color: #667eea;
}

.time-input-container select:nth-child(1) {
    flex: 1;
}

.time-input-container select:nth-child(2) {
    flex: 1;
}

.time-input-container select:nth-child(3) {
    flex: 0.8;
}

.install-admin-btn {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.3s ease;
    position: fixed;
    top: 10px;
    right: 60px;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
}

.install-admin-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
}

/* Update admin login modal to be more persistent */
#adminLoginModal.modal {
    pointer-events: all !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    backdrop-filter: blur(10px) !important;
}

#adminLoginModal .modal-content {
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5) !important;
    border: 2px solid rgba(52, 152, 219, 0.3) !important;
}

/* Hide admin dashboard completely when not logged in */
#adminDashboard {
    display: none;
}

/* Ensure body background is visible when logged out */
body {
    background-color: #f5f5f5 !important;
    min-height: 100vh;
}

.turf-header-section {
    text-align: center;
    margin-bottom: 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.turf-main-title {
    font-size: 24px;
    font-weight: 800;
    color: #2c3e50;
    margin: 0 auto;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 10px 0;
    text-align: center;
    width: 100%;
}

.admin-panel-subtitle {
    font-size: 16px;
    font-weight: 600;
    color: #7f8c8d;
    margin: 5px auto 0 auto;
    text-transform: none;
    letter-spacing: normal;
    text-align: center;
}

.admin-info {
    display: flex;
    justify-content: center;
    align-items: center;
    
    
}

.admin-info span {
    font-size: 14px;
    color: #7f8c8d;
    font-weight: 500;
}

/* Mobile responsive */
@media (max-width: 375px) {
    .turf-main-title {
        font-size: 20px;
        padding: 8px 0;
    }
}


        /* Refresh Button Styles */
        .refresh-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .refresh-btn:hover {
            background: #059669;
        }
        
        .refresh-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .refresh-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Notification Styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 350px;
        }
        
        .notification {
            background: #3b82f6;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease-out;
            position: relative;
            cursor: pointer;
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .notification.warning {
            background: #f59e0b;
        }
        
        .notification-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Pre-booking Styles */
        .pre-booking-card {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8fafc;
        }
        
        .pre-booking-type {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        /* Calendar Styles */
        .calendar-container {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .calendar-header {
            background: #3b82f6;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calendar-nav button {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .calendar-nav button:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
        }
        
        .calendar-day-header {
            background: #f3f4f6;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .calendar-day {
            background: white;
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day:hover {
            background: #f3f4f6;
        }
        
        .calendar-day.other-month {
            color: #9ca3af;
            background: #f9fafb;
        }
        
        .calendar-day.selected {
            background: #3b82f6;
            color: white;
        }
        
        .calendar-day.disabled {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        /* Form enhancements */
        .form-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .form-section h4 {
            margin: 0 0 15px 0;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 5px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        /* Tab enhancements */
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tab-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Modal enhancements */
        .modal-content.large {
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Time slot input */
        .time-slot-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: #f9fafb;
        }
        
        .time-slot-input input {
            flex: 1;
            margin: 0;
        }
        
        .remove-slot-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .add-slot-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* Status indicators */
        .status-active {
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .status-inactive {
            background: #6b7280;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }


        /* Day Slots View Styles */
.day-slots-section {
    border: 1px solid #e5e7db;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    background: white;
}

.slots-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 20px;
}

.date-navigation {
    border: 1px solid #d1d5db;
    border-radius: 8px;
    overflow: hidden;
    height: fit-content;
}

.date-nav-header {
    background: #3b82f6;
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: bold;
}

.date-nav-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.date-nav-controls button {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 4px;
}

.date-nav-controls button:hover {
    background: rgba(255,255,255,0.2);
}

.quick-dates {
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.quick-date-btn {
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
}

.quick-date-btn:hover {
    background: #e5e7eb;
}

.quick-date-btn.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
}

.slots-display {
    border: 1px solid #d1d5db;
    border-radius: 8px;
    overflow: hidden;
}

.slots-display-header {
    background: #f3f4f6;
    padding: 15px;
    border-bottom: 1px solid #d1d5db;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.slots-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    padding: 20px;
    max-height: 600px;
    overflow-y: auto;
}

.slot-card {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    min-height: 80px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.slot-card.available {
    background: white;
    border-color: #10b981;
}

.slot-card.available:hover {
    background: #f0fdf4;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
}

.slot-card.booked {
    background: #10b981;
    border-color: #059669;
    color: white;
}

.slot-card.pending {
    background: #f59e0b;
    border-color: #d97706;
    color: white;
}

.slot-time {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 5px;
}

.slot-price {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 8px;
}

.slot-card.booked .slot-price,
.slot-card.pending .slot-price {
    color: rgba(255,255,255,0.9);
}

.slot-customer {
    font-size: 12px;
    font-weight: 500;
}

.slot-status-badge {
    position: absolute;
    top: 5px;
    right: 5px;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: bold;
}

.slot-status-badge.available {
    background: #10b981;
    color: white;
}

.slot-status-badge.booked {
    background: #059669;
    color: white;
}

.slot-status-badge.pending {
    background: #d97706;
    color: white;
}

.slots-legend {
    display: flex;
    gap: 20px;
    padding: 15px;
    background: #f9fafb;
    border-top: 1px solid #e5e7eb;
    justify-content: center;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 2px solid;
}

.legend-color.available {
    background: white;
    border-color: #10b981;
}

.legend-color.booked {
    background: #10b981;
    border-color: #059669;
}

.legend-color.pending {
    background: #f59e0b;
    border-color: #d97706;
}

.slot-details-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.slot-details-content {
    background: white;
    padding: 20px;
    border-radius: 8px;
    max-width: 400px;
    width: 90%;
}

.close-popup {
    float: right;
    font-size: 24px;
    cursor: pointer;
    color: #6b7280;
}
/* Slot Grid Styles */
.slots-grid-container {
    margin-top: 20px;
}

.admin-slots-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    max-width: 1200px;
    margin: 0 auto;
}

.time-slot-box {
    height: 80px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease;
    border: 2px solid transparent;
}

.time-slot-box.available {
    background-color: #28a745;
    color: white;
}

.time-slot-box.available:hover {
    background-color: #218838;
    transform: scale(1.05);
}

.time-slot-box.booked {
    background-color: #dc3545;
    color: white;
    cursor: not-allowed;
}

.time-slot-box .time-text {
    font-size: 14px;
    font-weight: bold;
}

.time-slot-box .customer-name {
    font-size: 10px;
    margin-top: 4px;
    opacity: 0.9;
}

.time-slot-box .price-text {
    font-size: 11px;
    margin-top: 2px;
    opacity: 0.8;
}

@media (max-width: 768px) {
    .admin-slots-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .time-slot-box {
        height: 70px;
    }
}

.add-booking-btn {
    
    font-weight: 400;
    color: white;
    background: var(--primary-hover, #0056b3);
    border: none;
    border-radius: 6px; /* Reduced border radius */
    padding: 3px 9px;
    
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.add-booking-btn:hover {
    background: var(--primary-hover, #0056b3);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

    </style>
</head>
<body>
    <div class="container">
        <!-- Notification Container -->
        <div id="notificationContainer" class="notification-container"></div>

        <!-- Admin Login Modal -->
        <div id="adminLoginModal" class="modal">
            <div class="modal-content">
                <h2>Admin Login</h2>
                <input type="text" id="adminCode" placeholder="Admin Code" required>
                <input type="password" id="adminPassword" placeholder="Admin Password" required>
                <button onclick="adminLogin()">Login</button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="dashboard">
            <div class="header">
                <div class="turf-header-section">
                    <h1 id="turfName" class="turf-main-title">Loading...</h1>
                    <h2 class="admin-panel-subtitle">Admin Panel for bookings management</h2>
                </div>
                <div class="admin-info">
                    <span id="adminName"></span>
                    <button onclick="adminLogout()">Logout</button>
                </div>
            </div>

            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showAdminTab('bookings')">Booking Requests</div>
                <div class="nav-tab" onclick="showAdminTab('confirmed')">Confirmed Bookings</div>
                <div class="nav-tab" onclick="showAdminTab('prebookings')">Pre-Bookings</div>
                <div class="nav-tab" onclick="showAdminTab('turfs')">Manage Turfs</div>
            </div>

            <!-- Booking Requests Tab -->
            <div id="bookingsTab" class="tab-content active">
                <div class="tab-header">
                    <h2>Pending Booking Requests</h2>
                    <div class="tab-actions">
                        <button id="refreshBookingsBtn" class="refresh-btn" onclick="refreshBookings()">
                            <span id="refreshIcon">🔄</span> Refresh
                        </button>
                    </div>
                </div>
                <div id="pendingBookings" class="bookings-container"></div>
            </div>

            <!-- Confirmed Bookings Tab -->
<div id="confirmedTab" class="tab-content">
    <div class="tab-header">
        <h2>Slot Management</h2>
        <div class="tab-actions">
            <input type="date" id="slotDate" onchange="loadSlotView()" min="">
            <button class="refresh-btn" onclick="loadSlotView()">🔄 Refresh</button>
        </div>
    </div>
    <div class="slots-grid-container">
        <div id="slotsGrid" class="admin-slots-grid"></div>
    </div>
</div>
            <!-- Pre-Bookings Tab -->
            <div id="prebookingsTab" class="tab-content">
                <div class="tab-header">
                    <h2>Pre-Bookings & Fixed Bookings</h2>
                    <div class="tab-actions">
                        <button class="refresh-btn" onclick="loadPreBookings()">🔄 Refresh</button>
                        <button class="add-booking-btn" onclick="showAddPreBookingForm()">Add Pre-Booking</button>

                    </div>
                </div>
                <div id="preBookings" class="bookings-container"></div>
            </div>

            <!-- Manage Turfs Tab -->
            <div id="turfsTab" class="tab-content">
                <h2>Manage Turfs</h2>
                <div id="turfsContainer"></div>
            </div>
        </div>

        <!-- Enhanced Turf Modal -->
        <div id="turfModal" class="modal">
            <div class="modal-content large">
                <span class="close" onclick="closeModal('turfModal')">&times;</span>
                <h2 id="turfModalTitle">Edit Turf</h2>
                <form id="turfForm">
                    <input type="hidden" id="turfId">
                    
                    <!-- Basic Info -->
                    <div class="form-section">
                        <h4>Basic Information</h4>
                        <label for="turfName">Turf Name:</label>
                        <input type="text" id="turfName" placeholder="Turf Name" required>
                        
                        <label for="turfDescription">Description:</label>
                        <textarea id="turfDescription" placeholder="Description" rows="4" required></textarea>
                        
                        <label for="ownerPhone">Owner Phone Number:</label>
                        <input type="tel" id="ownerPhone" placeholder="Owner Phone Number" required>
                        
                        <label for="turfImageUrls">Image URLs:</label>
                        <input type="text" id="turfImageUrls" placeholder="Image URLs (comma separated)">
                    </div>
                    
                    <!-- Time Slots Management -->
                    <div class="form-section">
                        <h4>Available Time Slots</h4>
                        <div id="timeSlotsContainer">
                            <!-- Dynamic time slots will be added here -->
                        </div>
                        <button type="button" class="add-slot-btn" onclick="addTimeSlot()">Add Time Slot</button>
                    </div>
                    
                    <!-- Day Selection Calendar -->
                    <div class="form-section">
                        <h4>Available Days</h4>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="monday" value="monday">
                                <label for="monday">Monday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tuesday" value="tuesday">
                                <label for="tuesday">Tuesday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="wednesday" value="wednesday">
                                <label for="wednesday">Wednesday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="thursday" value="thursday">
                                <label for="thursday">Thursday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="friday" value="friday">
                                <label for="friday">Friday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="saturday" value="saturday">
                                <label for="saturday">Saturday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sunday" value="sunday">
                                <label for="sunday">Sunday</label>
                            </div>
                        </div>
                        
                        <h5>Or Select Specific Dates:</h5>
                        <div id="calendarContainer" class="calendar-container">
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button type="button" onclick="previousMonth()">&lt;</button>
                                    <span id="currentMonth">January 2025</span>
                                    <button type="button" onclick="nextMonth()">&gt;</button>
                                </div>
                            </div>
                            <div class="calendar-grid" id="calendarGrid">
                                <!-- Calendar will be generated here -->
                            </div>
                        </div>
                        <input type="hidden" id="selectedDates" value="">
                    </div>
                    
                    <!-- Day Time Pricing -->
                    <div class="form-section">
                        <h4>Day Time Pricing</h4>
                        <label>Start Time:</label>
                        <div class="time-input-container">
                            <select id="dayStartHour" required>
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="dayStartMinute" required>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="dayStartPeriod" required>
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        
                        <label>End Time:</label>
                        <div class="time-input-container">
                            <select id="dayEndHour" required>
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="dayEndMinute" required>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="dayEndPeriod" required>
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        
                        <label>Price per hour:</label>
                        <input type="number" id="dayPrice" placeholder="₹ per hour" min="1" required>
                    </div>
                    
                    <!-- Evening Time Pricing -->
                    <div class="form-section">
                        <h4>Evening Time Pricing</h4>
                        <label>Start Time:</label>
                        <div class="time-input-container">
                            <select id="eveningStartHour" required>
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="eveningStartMinute" required>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="eveningStartPeriod" required>
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        
                        <label>End Time:</label>
                        <div class="time-input-container">
                            <select id="eveningEndHour" required>
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="eveningEndMinute" required>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="eveningEndPeriod" required>
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        
                        <label>Price per hour:</label>
                        <input type="number" id="eveningPrice" placeholder="₹ per hour" min="1" required>
                    </div>
                    
                    <!-- Overall Operating Hours -->
                    <div class="form-section">
                        <h4>Operating Hours</h4>
                        <label for="openingTime">Opening Time:</label>
                        <div class="time-input-container">
                            <select id="openingHour" required>
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="openingMinute" required>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="openingPeriod" required>
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        
                        <label for="closingTime">Closing Time:</label>
                        <div class="time-input-container">
                            <select id="closingHour" required>
                                <option value="">Hour</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <select id="closingMinute" required>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                            <select id="closingPeriod" required>
                                <option value="">AM/PM</option>
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit">Save Turf</button>
                </form>
            </div>
        </div>

        <!-- Pre-Booking Modal -->
        <div id="preBookingModal" class="modal">
            <div class="modal-content large">
                <span class="close" onclick="closeModal('preBookingModal')">&times;</span>
                <h2>Add Pre-Booking</h2>
                <form id="preBookingForm">
                    <div class="form-section">
                        <h4>Booking Type</h4>
                        <select id="bookingType" onchange="handleBookingTypeChange()" required>
                            <option value="">Select Booking Type</option>
                            <option value="daily">Daily (Everyday)</option>
                            <option value="weekly">Weekly (Specific Days)</option>
                            <option value="custom">Custom Days</option>
                            <option value="specific">Specific Dates</option>
                        </select>
                    </div>

                    <div class="form-section" id="weeklyDaysSection" style="display: none;">
                        <h4>Select Days (Weekly)</h4>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="preMonday" value="monday">
                                <label for="preMonday">Monday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="preTuesday" value="tuesday">
                                <label for="preTuesday">Tuesday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="preWednesday" value="wednesday">
                                <label for="preWednesday">Wednesday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="preThursday" value="thursday">
                                <label for="preThursday">Thursday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="preFriday" value="friday">
                                <label for="preFriday">Friday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="preSaturday" value="saturday">
                                <label for="preSaturday">Saturday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="preSunday" value="sunday">
                                <label for="preSunday">Sunday</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-section" id="specificDatesSection" style="display: none;">
                        <h4>Select Specific Dates</h4>
                        <div id="preBookingCalendar" class="calendar-container">
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button type="button" onclick="previousPreBookingMonth()">&lt;</button>
                                    <span id="currentPreBookingMonth">January 2025</span>
                                    <button type="button" onclick="nextPreBookingMonth()">&gt;</button>
                                </div>
                            </div>
                            <div class="calendar-grid" id="preBookingCalendarGrid">
                                <!-- Calendar will be generated here -->
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Time Slots</h4>
                        <div id="preBookingTimeSlots">
                            <div class="time-slot-input">
                                <input type="time" placeholder="Start Time" required>
                                <span>to</span>
                                <input type="time" placeholder="End Time" required>
                                <button type="button" class="remove-slot-btn" onclick="removePreBookingTimeSlot(this)">Remove</button>
                            </div>
                        </div>
                        <button type="button" class="add-slot-btn" onclick="addPreBookingTimeSlot()">Add Time Slot</button>
                    </div>

                    <div class="form-section">
                        <h4>Customer Details</h4>
                        <label for="customerName">Customer Name:</label>
                        <input type="text" id="customerName" placeholder="Customer Name" required>
                        
                        <label for="customerPhone">Customer Phone:</label>
                        <input type="tel" id="customerPhone" placeholder="Customer Phone" required>
                        
                        <label for="duration">Duration (weeks):</label>
                        <input type="number" id="duration" placeholder="Duration in weeks" min="1" value="1" required>
                    </div>

                    <button type="submit">Create Pre-Booking</button>
                </form>
            </div>
        </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Global variables
        let currentAdmin = null;
        let pendingBookings = [];
        let confirmedBookings = [];
        let adminTurfs = [];
        let selectedDates = [];
        let selectedPreBookingDates = [];
        let currentDate = new Date();
        let preBookingCurrentDate = new Date();
        let autoRefreshInterval;
        let lastBookingCount = 0;
        

        // Supabase configuration
        const SUPABASE_URL = 'https://ktqwhwzbxyoplawjmbao.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0cXdod3pieHlvcGxhd2ptYmFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMzQ2ODgsImV4cCI6MjA2ODYxMDY4OH0.mo0mu-k3b_saK3I4gAGr4OIZcGZdRF5ogFMTqeijKas';
        let supabase;

        // Initialize Supabase client
        function initializeSupabase() {
            try {
                console.log("Initializing Supabase client...");
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                return true;
            } catch (error) {
                console.error('Error initializing Supabase:', error);
                return false;
            }
        }


        
        // Add this helper function near the top of your script (after the global variables)
function formatDateForDB(date) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
}

// Also add this function to get local date from string
function getLocalDateFromString(dateString) {
    const [year, month, day] = dateString.split('-');
    return new Date(year, month - 1, day); // month is 0-indexed
}


        // Initialize admin panel
        window.onload = function() {
            if (initializeSupabase()) {
                checkAdminAuth();
            } else {
                alert('Failed to initialize database connection');
            }
        };

// Add this helper function to convert 12-hour to 24-hour format
// Function to convert 12-hour format to 24-hour format
function convertTo24Hour(hour, minute, period) {
    let hour24 = parseInt(hour);
    
    if (period === 'AM') {
        if (hour24 === 12) {
            hour24 = 0; // 12 AM = 00:00
        }
    } else if (period === 'PM') {
        if (hour24 !== 12) {
            hour24 += 12; // 1 PM = 13:00, but 12 PM = 12:00
        }
    }
    
    return `${hour24.toString().padStart(2, '0')}:${minute}`;
}

// Function to convert 24-hour format to 12-hour format
function convertTo12Hour(time24h) {
    if (!time24h) return { hour: '', minute: '00', period: 'AM' };
    
    const [hours, minutes] = time24h.split(':');
    const hour24 = parseInt(hours);
    let hour12, period;
    
    if (hour24 === 0) {
        hour12 = 12;
        period = 'AM';
    } else if (hour24 < 12) {
        hour12 = hour24;
        period = 'AM';
    } else if (hour24 === 12) {
        hour12 = 12;
        period = 'PM';
    } else {
        hour12 = hour24 - 12;
        period = 'PM';
    }
    
    return {
        hour: hour12.toString(),
        minute: minutes,
        period: period
    };
}

// Update the editTurf function
function editTurf(turfId) {
    const turf = adminTurfs.find(t => t.turf_id === turfId);
    if (!turf) return;

    console.log('Editing turf:', turf); // Debug log

    document.getElementById('turfModalTitle').textContent = 'Edit Turf';
    document.getElementById('turfId').value = turf.turf_id;
    document.getElementById('turfName').value = turf.name || '';
    document.getElementById('turfDescription').value = turf.description || '';
    
    // Day pricing start time
    const dayStart = convertTo12Hour(turf.day_start_time || '06:00');
    document.getElementById('dayStartHour').value = dayStart.hour;
    document.getElementById('dayStartMinute').value = dayStart.minute;
    document.getElementById('dayStartPeriod').value = dayStart.period;
    
    // Day pricing end time
    const dayEnd = convertTo12Hour(turf.day_end_time || '18:00');
    document.getElementById('dayEndHour').value = dayEnd.hour;
    document.getElementById('dayEndMinute').value = dayEnd.minute;
    document.getElementById('dayEndPeriod').value = dayEnd.period;
    
    // Day price
    document.getElementById('dayPrice').value = turf.day_price || '';
    
    // Evening pricing start time
    const eveningStart = convertTo12Hour(turf.evening_start_time || '18:00');
    document.getElementById('eveningStartHour').value = eveningStart.hour;
    document.getElementById('eveningStartMinute').value = eveningStart.minute;
    document.getElementById('eveningStartPeriod').value = eveningStart.period;
    
    // Evening pricing end time
    const eveningEnd = convertTo12Hour(turf.evening_end_time || '23:59');
    document.getElementById('eveningEndHour').value = eveningEnd.hour;
    document.getElementById('eveningEndMinute').value = eveningEnd.minute;
    document.getElementById('eveningEndPeriod').value = eveningEnd.period;
    
    // Evening price
    document.getElementById('eveningPrice').value = turf.evening_price || '';
    
    // Operating hours
    const openingTime = convertTo12Hour(turf.opening_time || '06:00');
    document.getElementById('openingHour').value = openingTime.hour;
    document.getElementById('openingMinute').value = openingTime.minute;
    document.getElementById('openingPeriod').value = openingTime.period;
    
    const closingTime = convertTo12Hour(turf.closing_time || '23:00');
    document.getElementById('closingHour').value = closingTime.hour;
    document.getElementById('closingMinute').value = closingTime.minute;
    document.getElementById('closingPeriod').value = closingTime.period;
    
    // Images
    document.getElementById('turfImageUrls').value = turf.image_urls || '';

    // Add this line after setting image URLs
document.getElementById('ownerPhone').value = turf.owner_phone || '';

// Add this at the end before showModal
generateCalendar(currentDate, 'calendarGrid', selectedDates);
    
    showModal('turfModal');
}

// Update the form submission
// Update this part in the form submission event listener
document.getElementById('turfForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const turfId = document.getElementById('turfId').value;
    
    // Only allow editing existing turfs (no new turf creation)
    if (!turfId) {
        alert('Error: No turf selected for editing. Cannot save.');
        return;
    }

    const turfName = document.getElementById('turfName').value.trim();
    const turfDescription = document.getElementById('turfDescription').value.trim();
    const turfImageUrls = document.getElementById('turfImageUrls').value.trim();
    
    // Get day pricing values
    const dayStartHour = document.getElementById('dayStartHour').value;
    const dayStartMinute = document.getElementById('dayStartMinute').value;
    const dayStartPeriod = document.getElementById('dayStartPeriod').value;
    const dayEndHour = document.getElementById('dayEndHour').value;
    const dayEndMinute = document.getElementById('dayEndMinute').value;
    const dayEndPeriod = document.getElementById('dayEndPeriod').value;
    const dayPrice = parseInt(document.getElementById('dayPrice').value);
    
    // Get evening pricing values
    const eveningStartHour = document.getElementById('eveningStartHour').value;
    const eveningStartMinute = document.getElementById('eveningStartMinute').value;
    const eveningStartPeriod = document.getElementById('eveningStartPeriod').value;
    const eveningEndHour = document.getElementById('eveningEndHour').value;
    const eveningEndMinute = document.getElementById('eveningEndMinute').value;
    const eveningEndPeriod = document.getElementById('eveningEndPeriod').value;
    const eveningPrice = parseInt(document.getElementById('eveningPrice').value);
    
    // Get opening/closing time values
    const openingHour = document.getElementById('openingHour').value;
    const openingMinute = document.getElementById('openingMinute').value;
    const openingPeriod = document.getElementById('openingPeriod').value;
    const closingHour = document.getElementById('closingHour').value;
    const closingMinute = document.getElementById('closingMinute').value;
    const closingPeriod = document.getElementById('closingPeriod').value;

    // Validation
    if (!turfName || !turfDescription || !dayPrice || !eveningPrice) {
        alert('Please fill all required fields');
        return;
    }

    if (!dayStartHour || !dayStartMinute || !dayStartPeriod || !dayEndHour || !dayEndMinute || !dayEndPeriod) {
        alert('Please select complete day time pricing');
        return;
    }

    if (!eveningStartHour || !eveningStartMinute || !eveningStartPeriod || !eveningEndHour || !eveningEndMinute || !eveningEndPeriod) {
        alert('Please select complete evening time pricing');
        return;
    }

    if (!openingHour || !openingMinute || !openingPeriod || !closingHour || !closingMinute || !closingPeriod) {
        alert('Please select complete operating hours');
        return;
    }

    if (dayPrice < 1 || eveningPrice < 1) {
        alert('Prices must be at least ₹1 per hour');
        return;
    }

    // Convert to 24-hour format for storage
    const dayStartTime = convertTo24Hour(dayStartHour, dayStartMinute, dayStartPeriod);
    const dayEndTime = convertTo24Hour(dayEndHour, dayEndMinute, dayEndPeriod);
    const eveningStartTime = convertTo24Hour(eveningStartHour, eveningStartMinute, eveningStartPeriod);
    const eveningEndTime = convertTo24Hour(eveningEndHour, eveningEndMinute, eveningEndPeriod);
    const openingTime = convertTo24Hour(openingHour, openingMinute, openingPeriod);
    const closingTime = convertTo24Hour(closingHour, closingMinute, closingPeriod);

    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Updating...';
    submitBtn.disabled = true;

    try {
        const turfData = {
            name: turfName,
            description: turfDescription,
            day_price: dayPrice,
            day_start_time: dayStartTime,
            day_end_time: dayEndTime,
            evening_price: eveningPrice,
            evening_start_time: eveningStartTime,
            evening_end_time: eveningEndTime,
            opening_time: openingTime,
            closing_time: closingTime,
            image_urls: turfImageUrls || null,
            // Add this line in the turfData object
            owner_phone: document.getElementById('ownerPhone').value || null,
            // Removed admin_code and admin_password from update (they shouldn't change)
        };

        console.log('Updating turf data:', turfData);

        // ONLY UPDATE - No insert option
        const result = await supabase
            .from('turfs')
            .update(turfData)
            .eq('turf_id', parseInt(turfId))
            .select();

        if (result.error) {
            console.error('Error updating turf:', result.error);
            alert(`Failed to update turf: ${result.error.message}`);
            return;
        }

        if (!result.data || result.data.length === 0) {
            alert('No turf was updated. Please check if the turf exists.');
            return;
        }

        alert('Turf updated successfully!');
        closeModal('turfModal');
        loadAdminTurfs();
        
    } catch (error) {
        console.error('Error updating turf:', error);
        alert('Failed to update turf. Please try again.');
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
    
});



// Helper function to convert time to minutes for comparison
function convertTimeToMinutes(timeString) {
    const [hours, minutes] = timeString.split(':').map(Number);
    return hours * 60 + minutes;
}

// Clear form function
// function showAddTurfForm() {
//     document.getElementById('turfModalTitle').textContent = 'Add New Turf';
//     document.getElementById('turfForm').reset();
//     document.getElementById('turfId').value = '';
    
//    
//     document.getElementById('openingHour').value = '';
//     document.getElementById('openingMinute').value = '00';
//     document.getElementById('openingPeriod').value = '';
//     document.getElementById('closingHour').value = '';
//     document.getElementById('closingMinute').value = '00';
//     document.getElementById('closingPeriod').value = '';
    
//     showModal('turfModal');
// }

// Update the formatTimeForInput function
function formatTimeForInput(timeString) {
    if (!timeString) return '';
    
    // If it's already in HH:MM format (24-hour), return as is
    if (timeString.match(/^\d{1,2}:\d{2}$/)) {
        const [hours, minutes] = timeString.split(':');
        return `${hours.padStart(2, '0')}:${minutes}`;
    }
    
    // If it's in HH:MM:SS format, remove seconds
    if (timeString.match(/^\d{1,2}:\d{2}:\d{2}$/)) {
        return timeString.substring(0, 5);
    }
    
    // If it's in 12-hour format, convert to 24-hour
    if (timeString.includes('AM') || timeString.includes('PM') || timeString.includes('am') || timeString.includes('pm')) {
        return convertTo24Hour(timeString);
    }
    
    return timeString;
}

// Update the closeModal function to prevent closing admin login modal
function closeModal(modalId) {
    // Prevent closing admin login modal if admin is not logged in
    if (modalId === 'adminLoginModal' && !currentAdmin) {
        return; // Don't close the modal
    }
    
    document.getElementById(modalId).style.display = 'none';
    document.body.classList.remove('modal-open');
    const scrollY = document.body.style.top;
    document.body.style.top = '';
    window.scrollTo(0, parseInt(scrollY || '0') * -1);
}

// Update the window click handler to prevent closing admin login modal
window.onclick = function(event) {
    // If admin login modal is open and admin is not logged in, don't close anything
    const adminLoginModal = document.getElementById('adminLoginModal');
    if (adminLoginModal && adminLoginModal.style.display === 'block' && !currentAdmin) {
        event.preventDefault();
        event.stopPropagation();
        return false;
    }
    
    // For other modals, close normally
    if (event.target.classList.contains('modal') && event.target.id !== 'adminLoginModal') {
        event.target.style.display = 'none';
        document.body.classList.remove('modal-open');
        const scrollY = document.body.style.top;
        document.body.style.top = '';
        window.scrollTo(0, parseInt(scrollY || '0') * -1);
    }
}

// Add this new function to completely lock the admin login modal
function lockAdminLoginModal() {
    const adminLoginModal = document.getElementById('adminLoginModal');
    if (adminLoginModal && !currentAdmin) {
        // Prevent all click events from bubbling up
        adminLoginModal.addEventListener('click', function(e) {
            if (e.target === adminLoginModal) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        });
        
        // Prevent modal content clicks from closing
        const modalContent = adminLoginModal.querySelector('.modal-content');
        if (modalContent) {
            modalContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }
    }
}

// Update your checkAdminAuth function
function checkAdminAuth() {
    const admin = localStorage.getItem('currentAdmin');
    if (admin) {
        currentAdmin = JSON.parse(admin);
        showAdminDashboard();
    } else {
        showModal('adminLoginModal');
        lockAdminLoginModal(); // Add this line
    }
}

// Update your adminLogout function
function adminLogout() {
    localStorage.removeItem('currentAdmin');
    currentAdmin = null;
    document.getElementById('adminDashboard').style.display = 'none';
    showModal('adminLoginModal');
    lockAdminLoginModal(); // Add this line
    // Add this line at the beginning of adminLogout function
stopAutoRefresh();
}

// Update keyboard event handler to prevent closing admin login modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const adminLoginModal = document.getElementById('adminLoginModal');
        if (adminLoginModal && adminLoginModal.style.display === 'block' && !currentAdmin) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
        
        // Close other modals normally
        document.querySelectorAll('.modal').forEach(modal => {
            if (modal.style.display === 'block' && modal.id !== 'adminLoginModal') {
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
            }
        });
    }
});


        async function adminLogin() {
            const adminCode = document.getElementById('adminCode').value;
            const adminPassword = document.getElementById('adminPassword').value;

            if (!adminCode || !adminPassword) {
                alert('Please fill all fields');
                return;
            }

            try {
                // Check admin credentials in turfs table
                const { data: turfs, error } = await supabase
                    .from('turfs')
                    .select('*')
                    .eq('admin_code', adminCode)
                    .eq('admin_password', adminPassword);

                if (error) {
                    console.error('Admin login error:', error);
                    alert('Login failed. Please try again.');
                    return;
                }

                if (turfs.length > 0) {
                    currentAdmin = { 
                        admin_code: adminCode, 
                        admin_password: adminPassword,
                        name: `Admin (${adminCode})`
                    };
                    localStorage.setItem('currentAdmin', JSON.stringify(currentAdmin));
                    closeModal('adminLoginModal');
                    showAdminDashboard();
                } else {
                    alert('Invalid admin credentials');
                }
            } catch (error) {
                console.error('Admin login error:', error);
                alert('Login failed. Please try again.');
            }
        }

        

        async function showAdminDashboard() {
    document.getElementById('adminDashboard').style.display = 'block';
    
    // Display admin name
    document.getElementById('adminName').textContent = `Admin: ${currentAdmin.admin_code}`;
    
    // Load turfs first, then display turf name
    await loadAdminTurfs();
    
    // Display turf name after turfs are loaded
    if (adminTurfs && adminTurfs.length > 0) {
        document.getElementById('turfName').textContent = `${adminTurfs[0].name}`;
    } else {
        document.getElementById('turfName').textContent = 'Turf: None';
    }
    
    showAdminTab('bookings');
    startAutoRefresh(); // Start auto-refresh
}



// Notification System
function showNotification(message, type = 'info', duration = 5000) {
    const container = document.getElementById('notificationContainer');
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        ${message}
        <button class="notification-close" onclick="closeNotification(this)">&times;</button>
    `;
    
    container.appendChild(notification);
    
    // Auto-remove after duration
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, duration);
}

function closeNotification(button) {
    button.parentElement.remove();
}

// Auto-refresh functionality
function startAutoRefresh() {
    // Refresh every 15 seconds
    autoRefreshInterval = setInterval(async () => {
        await checkForNewBookings();
    }, 15000);
}

function stopAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
}

async function checkForNewBookings() {
    try {
        const { data: adminTurfsData, error: turfsError } = await supabase
            .from('turfs')
            .select('turf_id')
            .eq('admin_code', currentAdmin.admin_code)
            .eq('admin_password', currentAdmin.admin_password);

        if (turfsError) return;

        const turfIds = adminTurfsData.map(turf => turf.turf_id);

        const { data: bookingsData, error } = await supabase
            .from('bookings')
            .select('booking_id')
            .in('turf_id', turfIds)
            .eq('status', 'pending');

        if (error) return;

        const currentBookingCount = bookingsData.length;
        
        if (currentBookingCount > lastBookingCount) {
            const newBookings = currentBookingCount - lastBookingCount;
            showNotification(`${newBookings} new booking request(s) received!`, 'success');
            
            // Refresh the current tab if it's bookings
            const activeTab = document.querySelector('.nav-tab.active');
            if (activeTab && activeTab.textContent.trim() === 'Booking Requests') {
                loadPendingBookings();
            }
        }
        
        lastBookingCount = currentBookingCount;
    } catch (error) {
        console.error('Error checking for new bookings:', error);
    }
}

// Enhanced refresh function
async function refreshBookings() {
    const refreshBtn = document.getElementById('refreshBookingsBtn');
    const refreshIcon = document.getElementById('refreshIcon');
    
    refreshBtn.disabled = true;
    refreshIcon.classList.add('refresh-icon');
    refreshBtn.innerHTML = '<span class="refresh-icon">🔄</span> Refreshing...';
    
    try {
        await loadPendingBookings();
        showNotification('Bookings refreshed successfully!', 'success', 2000);
    } catch (error) {
        showNotification('Failed to refresh bookings', 'error');
    } finally {
        refreshBtn.disabled = false;
        refreshIcon.classList.remove('refresh-icon');
        refreshBtn.innerHTML = '<span>🔄</span> Refresh';
    }
}

// Calendar functions
function generateCalendar(date, containerId, selectedDatesArray) {
    const year = date.getFullYear();
    const month = date.getMonth();
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    
    const monthHeader = containerId === 'calendarGrid' ? 
        document.getElementById('currentMonth') : 
        document.getElementById('currentPreBookingMonth');
    
    monthHeader.textContent = `${monthNames[month]} ${year}`;
    
    const grid = document.getElementById(containerId);
    grid.innerHTML = '';
    
    // Add day headers
    const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    dayHeaders.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day-header';
        dayHeader.textContent = day;
        grid.appendChild(dayHeader);
    });
    
    // Add calendar days
   
const current = new Date(startDate);
for (let i = 0; i < 42; i++) {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    dayElement.textContent = current.getDate();
    
    const dateString = formatDateForDB(current);

        if (current.getMonth() !== month) {
            dayElement.classList.add('other-month');
        }
        
       const today = new Date();
today.setHours(0,0,0,0);
const currentDateOnly = new Date(current);
currentDateOnly.setHours(0,0,0,0);
if (currentDateOnly < today) {
            dayElement.classList.add('disabled');
        } else {
            if (selectedDatesArray.includes(dateString)) {
                dayElement.classList.add('selected');
            }
            
            dayElement.addEventListener('click', () => {
                if (containerId === 'calendarGrid') {
                    toggleDateSelection(dateString, dayElement, selectedDates);
                } else {
                    toggleDateSelection(dateString, dayElement, selectedPreBookingDates);
                }
            });
        }
        
        grid.appendChild(dayElement);
        current.setDate(current.getDate() + 1);
    }
}

function toggleDateSelection(dateString, element, selectedArray) {
    const index = selectedArray.indexOf(dateString);
    if (index > -1) {
        selectedArray.splice(index, 1);
        element.classList.remove('selected');
    } else {
        selectedArray.push(dateString);
        element.classList.add('selected');
    }
    
    if (selectedArray === selectedDates) {
        document.getElementById('selectedDates').value = selectedArray.join(',');
    }
}

function previousMonth() {
    currentDate.setMonth(currentDate.getMonth() - 1);
    generateCalendar(currentDate, 'calendarGrid', selectedDates);
}

function nextMonth() {
    currentDate.setMonth(currentDate.getMonth() + 1);
    generateCalendar(currentDate, 'calendarGrid', selectedDates);
}

function previousPreBookingMonth() {
    preBookingCurrentDate.setMonth(preBookingCurrentDate.getMonth() - 1);
    generateCalendar(preBookingCurrentDate, 'preBookingCalendarGrid', selectedPreBookingDates);
}

function nextPreBookingMonth() {
    preBookingCurrentDate.setMonth(preBookingCurrentDate.getMonth() + 1);
    generateCalendar(preBookingCurrentDate, 'preBookingCalendarGrid', selectedPreBookingDates);
}

// Time slot management
function addTimeSlot() {
    const container = document.getElementById('timeSlotsContainer');
    const slotDiv = document.createElement('div');
    slotDiv.className = 'time-slot-input';
    slotDiv.innerHTML = `
        <input type="time" placeholder="Start Time" required>
        <span>to</span>
        <input type="time" placeholder="End Time" required>
        <input type="number" placeholder="Price per hour" min="1" required>
        <button type="button" class="remove-slot-btn" onclick="removeTimeSlot(this)">Remove</button>
    `;
    container.appendChild(slotDiv);
}

function removeTimeSlot(button) {
    button.parentElement.remove();
}

// Pre-booking functions
function showAddPreBookingForm() {
    document.getElementById('preBookingForm').reset();
    selectedPreBookingDates = [];
    generateCalendar(preBookingCurrentDate, 'preBookingCalendarGrid', selectedPreBookingDates);
    showModal('preBookingModal');
}

function handleBookingTypeChange() {
    const bookingType = document.getElementById('bookingType').value;
    const weeklySection = document.getElementById('weeklyDaysSection');
    const specificSection = document.getElementById('specificDatesSection');
    
    weeklySection.style.display = (bookingType === 'weekly' || bookingType === 'custom') ? 'block' : 'none';
    specificSection.style.display = (bookingType === 'specific') ? 'block' : 'none';
}

function addPreBookingTimeSlot() {
    const container = document.getElementById('preBookingTimeSlots');
    const slotDiv = document.createElement('div');
    slotDiv.className = 'time-slot-input';
    slotDiv.innerHTML = `
        <input type="time" placeholder="Start Time" required>
        <span>to</span>
        <input type="time" placeholder="End Time" required>
        <button type="button" class="remove-slot-btn" onclick="removePreBookingTimeSlot(this)">Remove</button>
    `;
    container.appendChild(slotDiv);
}

function removePreBookingTimeSlot(button) {
    if (document.getElementById('preBookingTimeSlots').children.length > 1) {
        button.parentElement.remove();
    }
}

async function loadPreBookings() {
    // Just load confirmed bookings - same as confirmed tab but maybe with different display
    loadConfirmedBookings();
    
    // Or if you want to show all bookings created by admin:
    try {
        const { data: adminTurfsData, error: turfsError } = await supabase
            .from('turfs')
            .select('turf_id')
            .eq('admin_code', currentAdmin.admin_code)
            .eq('admin_password', currentAdmin.admin_password);

        if (turfsError) {
            console.error('Error loading admin turfs:', turfsError);
            return;
        }

        const turfIds = adminTurfsData.map(turf => turf.turf_id);

        const { data: bookingsData, error } = await supabase
            .from('bookings')
            .select(`
                *,
                turfs (name)
            `)
            .in('turf_id', turfIds)
            .eq('status', 'confirmed')
            .order('booking_date', { ascending: true });

        if (error) {
            console.error('Error loading bookings:', error);
            return;
        }

        // Display in the pre-bookings container
        const container = document.getElementById('preBookings');
        
        if (bookingsData.length === 0) {
            container.innerHTML = '<p>No bookings found.</p>';
            return;
        }

        container.innerHTML = bookingsData.map(booking => `
            <div class="booking-card confirmed">
                <div class="booking-header">
                    <h3>${booking.turfs ? booking.turfs.name : 'Unknown Turf'}</h3>
                    <span class="booking-id">ID: ${booking.booking_id}</span>
                </div>
                <div class="booking-details">
                    <p><strong>Customer:</strong> ${booking.user_name}</p>
                    <p><strong>Phone:</strong> ${booking.user_phone}</p>
                    <p><strong>Date:</strong> ${booking.booking_date}</p>
                    <p><strong>Time Slots:</strong> ${booking.time_slots}</p>
                    <p><strong>Total Hours:</strong> ${booking.total_hours}</p>
                    <p><strong>Total Price:</strong> ₹${booking.total_price}</p>
                </div>
                <div class="booking-actions">
                    <button onclick="cancelBooking(${booking.booking_id})" class="reject-btn">Cancel</button>
                </div>
            </div>
        `).join('');
        
    } catch (error) {
        console.error('Error loading bookings:', error);
    }
}
async function cancelBooking(bookingId) {
    if (!confirm('Are you sure you want to cancel this booking?')) return;
    
    try {
        const { error } = await supabase
            .from('bookings')
            .update({ status: 'cancelled' })
            .eq('booking_id', bookingId);

        if (error) {
            console.error('Error cancelling booking:', error);
            showNotification('Failed to cancel booking', 'error');
            return;
        }

        showNotification('Booking cancelled successfully!', 'success');
        loadPreBookings();
        loadConfirmedBookings();
    } catch (error) {
        console.error('Error cancelling booking:', error);
        showNotification('Failed to cancel booking', 'error');
    }
}
function displayPreBookings() {
    const container = document.getElementById('preBookings');
    
    if (preBookings.length === 0) {
        container.innerHTML = '<p>No pre-bookings found.</p>';
        return;
    }

    container.innerHTML = preBookings.map(booking => `
        <div class="pre-booking-card">
            <div class="booking-header">
                <h3>${booking.turfs ? booking.turfs.name : 'Unknown Turf'}</h3>
                <div>
                    <span class="pre-booking-type">PRE-BOOKING</span>
                    <span class="status-${booking.status}">${booking.status.toUpperCase()}</span>
                </div>
            </div>
            <div class="booking-details">
                <p><strong>Customer:</strong> ${booking.user_name}</p>
                <p><strong>Phone:</strong> ${booking.user_phone}</p>
                <p><strong>Date:</strong> ${booking.booking_date}</p>
                <p><strong>Time Slots:</strong> ${booking.time_slots}</p>
                <p><strong>Total Hours:</strong> ${booking.total_hours}</p>
                <p><strong>Total Price:</strong> ₹${booking.total_price}</p>
                <p><strong>Created:</strong> ${new Date(booking.created_at).toLocaleDateString()}</p>
            </div>
            <div class="booking-actions">
                <button onclick="togglePreBookingStatus(${booking.booking_id})" class="confirm-btn">
                    ${booking.status === 'confirmed' ? 'Cancel' : 'Confirm'}
                </button>
                <button onclick="deletePreBooking(${booking.booking_id})" class="reject-btn">Delete</button>
            </div>
        </div>
    `).join('');
}
async function togglePreBookingStatus(bookingId) {
    const booking = preBookings.find(b => b.booking_id === bookingId);
    const newStatus = booking.status === 'confirmed' ? 'cancelled' : 'confirmed';
    
    try {
        const { error } = await supabase
            .from('bookings')
            .update({ status: newStatus })
            .eq('booking_id', bookingId);

        if (error) {
            console.error('Error updating pre-booking status:', error);
            showNotification('Failed to update pre-booking status', 'error');
            return;
        }

        showNotification('Pre-booking status updated successfully!', 'success');
        loadPreBookings();
    } catch (error) {
        console.error('Error updating pre-booking status:', error);
        showNotification('Failed to update pre-booking status', 'error');
    }
}
async function deletePreBooking(bookingId) {
    if (!confirm('Are you sure you want to delete this pre-booking?')) return;
    
    try {
        const { error } = await supabase
            .from('bookings')
            .delete()
            .eq('booking_id', bookingId);

        if (error) {
            console.error('Error deleting pre-booking:', error);
            showNotification('Failed to delete pre-booking', 'error');
            return;
        }

        showNotification('Pre-booking deleted successfully!', 'success');
        loadPreBookings();
    } catch (error) {
        console.error('Error deleting pre-booking:', error);
        showNotification('Failed to delete pre-booking', 'error');
    }
}
        async function loadPendingBookings() {
            try {
                // Get turfs managed by this admin
                const { data: adminTurfsData, error: turfsError } = await supabase
                    .from('turfs')
                    .select('turf_id')
                    .eq('admin_code', currentAdmin.admin_code)
                    .eq('admin_password', currentAdmin.admin_password);

                if (turfsError) {
                    console.error('Error loading admin turfs:', turfsError);
                    return;
                }

                const turfIds = adminTurfsData.map(turf => turf.turf_id);

                // Get pending bookings for admin's turfs
                const { data: bookingsData, error } = await supabase
                    .from('bookings')
                    .select(`
                        *,
                        turfs (name, price)
                    `)
                    .in('turf_id', turfIds)
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error loading pending bookings:', error);
                    return;
                }

                pendingBookings = bookingsData;
                displayPendingBookings();
            } catch (error) {
                console.error('Error loading pending bookings:', error);
            }
        }

        function displayPendingBookings() {
            const container = document.getElementById('pendingBookings');
            
            if (pendingBookings.length === 0) {
                container.innerHTML = '<p>No pending booking requests.</p>';
                return;
            }

            container.innerHTML = pendingBookings.map(booking => `
                <div class="booking-card">
                    <div class="booking-header">
                        <h3>${booking.turfs ? booking.turfs.name : 'Unknown Turf'}</h3>
                        <span class="booking-id">ID: ${booking.booking_id}</span>
                    </div>
                    <div class="booking-details">
                        <p><strong>Customer:</strong> ${booking.user_name}</p>
                        <p><strong>Phone:</strong> ${booking.user_phone}</p>
                        <p><strong>Date:</strong> ${booking.booking_date}</p>
                        <p><strong>Time Slots:</strong> ${booking.time_slots}</p>
                        <p><strong>Total Hours:</strong> ${booking.total_hours}</p>
                        <p><strong>Total Price:</strong> ₹${booking.total_price}</p>
                        <p><strong>Requested on:</strong> ${new Date(booking.created_at).toLocaleDateString()}</p>
                    </div>
                    <div class="booking-actions">
                        <button onclick="confirmBooking(${booking.booking_id})" class="confirm-btn">Confirm</button>
                        <button onclick="rejectBooking(${booking.booking_id})" class="reject-btn">Reject</button>
                    </div>
                </div>
            `).join('');
        }

        async function confirmBooking(bookingId) {
            try {
                const { data, error } = await supabase
                    .from('bookings')
                    .update({ status: 'confirmed' })
                    .eq('booking_id', bookingId);

                if (error) {
                    console.error('Error confirming booking:', error);
                    alert('Failed to confirm booking');
                    return;
                }

                alert('Booking confirmed successfully!');
                loadPendingBookings();
                loadConfirmedBookings();
            } catch (error) {
                console.error('Error confirming booking:', error);
                alert('Failed to confirm booking');
            }
        }

        async function rejectBooking(bookingId) {
            try {
                const { data, error } = await supabase
                    .from('bookings')
                    .update({ status: 'rejected' })
                    .eq('booking_id', bookingId);

                if (error) {
                    console.error('Error rejecting booking:', error);
                    alert('Failed to reject booking');
                    return;
                }

                alert('Booking rejected successfully!');
                loadPendingBookings();
            } catch (error) {
                console.error('Error rejecting booking:', error);
                alert('Failed to reject booking');
            }
        }

       async function loadConfirmedBookings() {
    // Set today's date as default
    const today = new Date();
    const todayString = formatDateForDB(today);
    document.getElementById('slotDate').value = todayString;
    document.getElementById('slotDate').min = todayString;
    
    loadSlotView();
}

// Add this new function
async function loadSlotView() {
    const dateInput = document.getElementById('slotDate');
    const selectedDate = dateInput.value;
    
    if (!selectedDate) {
        const today = new Date();
        dateInput.value = formatDateForDB(today);
        loadSlotView();
        return;
    }

    try {
        // Get admin's turf
        if (!adminTurfs || adminTurfs.length === 0) {
            await loadAdminTurfs();
        }
        
        if (adminTurfs.length === 0) {
            document.getElementById('slotsGrid').innerHTML = '<p>No turfs found</p>';
            return;
        }
        
        const turf = adminTurfs[0];
        
        // Load all bookings for this date
        const { data: bookingsData, error } = await supabase
            .from('bookings')
            .select('*')
            .eq('turf_id', turf.turf_id)
            .eq('booking_date', selectedDate)
            .in('status', ['confirmed', 'pending']);

        if (error) {
            console.error('Error loading bookings:', error);
            return;
        }

        // Process booked slots
        const bookedSlots = new Map();
        
        if (bookingsData) {
            bookingsData.forEach(booking => {
                if (booking.time_slots) {
                    const slots = booking.time_slots.split(',').map(s => s.trim());
                    slots.forEach(slot => {
                        bookedSlots.set(slot, {
                            customer: booking.user_name,
                            phone: booking.user_phone,
                            status: booking.status,
                            bookingId: booking.booking_id
                        });
                    });
                }
            });
        }

        // Display the 18 time slots
        displaySlotGrid(bookedSlots, turf, selectedDate);
        
    } catch (error) {
        console.error('Error loading slot view:', error);
    }
}

// Add this new function
function displaySlotGrid(bookedSlots, turf, selectedDate) {
    const container = document.getElementById('slotsGrid');
    const timeSlots = [];
    
    // Generate 18 time slots from 6 AM to 12 AM
    for (let hour = 6; hour < 24; hour++) {
        const timeSlot = `${hour.toString().padStart(2, '0')}:00-${(hour + 1).toString().padStart(2, '0')}:00`;
        timeSlots.push(timeSlot);
    }
    
    let slotsHtml = '';
    
    timeSlots.forEach(slot => {
        const booking = bookedSlots.get(slot);
        const isBooked = booking !== undefined;
        const price = getPriceForTimeSlot(turf, slot);
        
        // Format time display (6-7, 7-8, etc.)
        const [startHour] = slot.split('-')[0].split(':');
        const endHour = parseInt(startHour) + 1;
        const timeDisplay = `${parseInt(startHour)}-${endHour}`;
        
        let slotClass = isBooked ? 'booked' : 'available';
        let customerInfo = '';
        let onClickAction = '';
        
        if (isBooked) {
            customerInfo = `<div class="customer-name">${booking.customer}</div>`;
            onClickAction = `onclick="unBookSlot('${slot}', ${booking.bookingId})"`;
        } else {
            onClickAction = `onclick="quickBookSlot('${slot}', ${price}, '${selectedDate}')"`;
        }
        
        slotsHtml += `
            <div class="time-slot-box ${slotClass}" ${onClickAction} data-slot="${slot}">
                <div class="time-text">${timeDisplay}</div>
                <div class="price-text">₹${price}</div>
                ${customerInfo}
            </div>
        `;
    });
    
    container.innerHTML = slotsHtml;
}

// Add these new functions for quick booking
async function quickBookSlot(slot, price, date) {
    try {
        const bookingData = {
            turf_id: adminTurfs[0].turf_id,
            user_name: 'Admin Booking',
            user_phone: 'N/A',
            booking_date: date,
            time_slots: slot,
            total_hours: 1,
            total_price: price,
            status: 'confirmed',
            booking_type: 'admin_created'
        };

        const { error } = await supabase
            .from('bookings')
            .insert([bookingData]);

        if (error) {
            console.error('Error creating booking:', error);
            return;
        }

        loadSlotView(); // Refresh the view instantly
    } catch (error) {
        console.error('Error creating booking:', error);
    }
}

async function unBookSlot(slot, bookingId) {
    try {
        const { error } = await supabase
            .from('bookings')
            .update({ status: 'cancelled' })
            .eq('booking_id', bookingId);

        if (error) {
            console.error('Error cancelling booking:', error);
            return;
        }

        loadSlotView(); // Refresh the view instantly
    } catch (error) {
        console.error('Error cancelling booking:', error);
    }
}
// Add this helper function if you don't have it
function getPriceForTimeSlot(turf, timeSlot) {
    const [startTime] = timeSlot.split('-');
    const [hour] = startTime.split(':').map(Number);
    
    const [dayStart] = turf.day_start_time.split(':').map(Number);
    const [dayEnd] = turf.day_end_time.split(':').map(Number);
    
    if (hour >= dayStart && hour < dayEnd) {
        return turf.day_price || 500;
    } else {
        return turf.evening_price || 700;
    }
}

// Add this near your other global variables
function formatDateForDB(date) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
}



        function displayConfirmedBookings() {
            const container = document.getElementById('confirmedBookings');
            
            if (confirmedBookings.length === 0) {
                container.innerHTML = '<p>No confirmed bookings.</p>';
                return;
            }

            container.innerHTML = confirmedBookings.map(booking => `
                <div class="booking-card confirmed">
                    <div class="booking-header">
                        <h3>${booking.turfs ? booking.turfs.name : 'Unknown Turf'}</h3>
                        <span class="booking-id">ID: ${booking.booking_id}</span>
                    </div>
                    <div class="booking-details">
                        <p><strong>Customer:</strong> ${booking.user_name}</p>
                        <p><strong>Phone:</strong> ${booking.user_phone}</p>
                        <p><strong>Date:</strong> ${booking.booking_date}</p>
                        <p><strong>Time Slots:</strong> ${booking.time_slots}</p>
                        <p><strong>Total Hours:</strong> ${booking.total_hours}</p>
                        <p><strong>Total Price:</strong> ₹${booking.total_price}</p>
                        <p><strong>Confirmed on:</strong> ${new Date(booking.created_at).toLocaleDateString()}</p>
                    </div>
                </div>
            `).join('');
        }

        async function loadAdminTurfs() {
            try {
                const { data: turfsData, error } = await supabase
                    .from('turfs')
                    .select('*')
                    .eq('admin_code', currentAdmin.admin_code)
                    .eq('admin_password', currentAdmin.admin_password);

                if (error) {
                    console.error('Error loading admin turfs:', error);
                    return;
                }

                adminTurfs = turfsData;
                displayAdminTurfs();
            } catch (error) {
                console.error('Error loading admin turfs:', error);
            }
        }

        function displayAdminTurfs() {
    const container = document.getElementById('turfsContainer');
    
    if (adminTurfs.length === 0) {
        container.innerHTML = '<p>No turfs found.</p>';
        return;
    }

    // Make sure edit buttons are included
    container.innerHTML = adminTurfs.map(turf => `
        <div class="turf-card">
            <div class="turf-header">
                <h3>${turf.name}</h3>
                <div class="turf-actions">
                    <button onclick="editTurf(${turf.turf_id})" class="edit-btn">Edit</button>
                    <button onclick="deleteTurf(${turf.turf_id})" class="delete-btn">Delete</button>
                </div>
            </div>
            <div class="turf-details">
                <p><strong>Day Price:</strong> ₹${turf.day_price || 'Not set'}/hour</p>
                <p><strong>Evening Price:</strong> ₹${turf.evening_price || 'Not set'}/hour</p>
                <p><strong>Description:</strong> ${turf.description}</p>
                <p><strong>Operating Hours:</strong> ${formatTime(turf.opening_time)} - ${formatTime(turf.closing_time)}</p>
            </div>
        </div>
    `).join('');
}
        async function deleteTurf(turfId) {
            if (!confirm('Are you sure you want to delete this turf?')) return;

            try {
                const { data, error } = await supabase
                    .from('turfs')
                    .delete()
                    .eq('turf_id', turfId);

                if (error) {
                    console.error('Error deleting turf:', error);
                    alert('Failed to delete turf');
                    return;
                }

                alert('Turf deleted successfully!');
                loadAdminTurfs();
            } catch (error) {
                console.error('Error deleting turf:', error);
                alert('Failed to delete turf');
            }
        }

        // Handle turf form submission
        // Update your turfForm event listener


        // Tab navigation functions
        function showAdminTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(navTab => navTab.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Add active class to selected nav tab
            event.target.classList.add('active');

            // Load data for the selected tab
            if (tabName === 'bookings') {
                loadPendingBookings();
            } else if (tabName === 'confirmed') {
                loadConfirmedBookings();
            } else if (tabName === 'turfs') {
                loadAdminTurfs();
            }// Add this case in the existing if/else chain
              else if (tabName === 'prebookings') {
                    loadPreBookings();
            }
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        

       

        // Utility functions
        function formatTime(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }


        // Auto-refresh bookings every 30 seconds
        setInterval(() => {
            if (currentAdmin && document.getElementById('adminDashboard').style.display === 'block') {
                const activeTab = document.querySelector('.nav-tab.active');
                if (activeTab) {
                    const tabText = activeTab.textContent.trim();
                    if (tabText === 'Booking Requests') {
                        loadPendingBookings();
                    } else if (tabText === 'Confirmed Bookings') {
                        loadConfirmedBookings();
                    }
                }
            }
        }, 30000);


        // Add this to your existing JavaScript in admin.html

let deferredPrompt;

// Register Service Worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
        try {
            const registration = await navigator.serviceWorker.register('/sw.js');
            console.log('Admin SW registered:', registration.scope);
            
            // Update handling
            registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        if (confirm('New admin version available! Reload?')) {
                            window.location.reload();
                        }
                    }
                });
            });
        } catch (error) {
            console.log('Admin SW registration failed:', error);
        }
    });
}

// PWA Install Prompt for Admin
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    showAdminInstallPrompt();
});

function showAdminInstallPrompt() {
    const installBtn = document.createElement('button');
    installBtn.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7,10 12,15 17,10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Install Admin App
    `;
    installBtn.className = 'install-admin-btn';
    installBtn.addEventListener('click', installAdminApp);
    
    // Add to header
    const header = document.querySelector('.header');
    if (header && deferredPrompt) {
        header.appendChild(installBtn);
    }
}

async function installAdminApp() {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`Admin install: ${outcome}`);
        deferredPrompt = null;
        
        const installBtn = document.querySelector('.install-admin-btn');
        if (installBtn) installBtn.remove();
    }
}

// Handle app installation
window.addEventListener('appinstalled', (evt) => {
    console.log('Admin PWA installed');
    const installBtn = document.querySelector('.install-admin-btn');
    if (installBtn) installBtn.remove();
});

        // Handle Enter key press in admin login
        document.getElementById('adminCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                adminLogin();
            }
        });

        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                adminLogin();
            }
        });



        // Pre-booking form submission
// Pre-booking form submission
// Pre-booking form submission - Simple approach
document.getElementById('preBookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const bookingType = document.getElementById('bookingType').value;
    const customerName = document.getElementById('customerName').value;
    const customerPhone = document.getElementById('customerPhone').value;
    const duration = parseInt(document.getElementById('duration').value);

    // Get time slots
    const timeSlotInputs = document.querySelectorAll('#preBookingTimeSlots .time-slot-input');
    const timeSlots = [];
    timeSlotInputs.forEach(slot => {
        const startTime = slot.querySelector('input[type="time"]:first-child').value;
        const endTime = slot.querySelector('input[type="time"]:last-of-type').value;
        if (startTime && endTime) {
            timeSlots.push(`${startTime}-${endTime}`);
        }
    });

    if (timeSlots.length === 0) {
        showNotification('Please add at least one time slot', 'error');
        return;
    }

    // Calculate total hours
    let totalHours = 0;
    timeSlots.forEach(slot => {
        const [start, end] = slot.split('-');
        const startTime = new Date(`2000-01-01 ${start}`);
        const endTime = new Date(`2000-01-01 ${end}`);
        totalHours += (endTime - startTime) / (1000 * 60 * 60);
    });

    // Get dates to book
let datesToBook = [];
const today = new Date();

if (bookingType === 'specific') {
    datesToBook = [...selectedPreBookingDates];
} else {
    // For other types, get next 30 days as example
    for (let i = 0; i < 30; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() + i);
        
        if (bookingType === 'daily') {
            datesToBook.push(formatDateForDB(date)); // ← FIXED
        } else if (bookingType === 'weekly' || bookingType === 'custom') {
            const dayOfWeek = date.getDay();
            const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const currentDay = dayNames[dayOfWeek];
            
            // Check if this day is selected
            if (document.getElementById('pre' + currentDay.charAt(0).toUpperCase() + currentDay.slice(1)).checked) {
                datesToBook.push(formatDateForDB(date)); // ← FIXED
            }
        }
    }
}

    // Create individual bookings for each date
    try {
        let successCount = 0;
        
        for (const date of datesToBook) {
            // Simple booking creation - exactly like user bookings
            const { data, error } = await supabase
                .from('bookings')
                .insert([{
                    turf_id: adminTurfs[0].turf_id,
                    user_name: customerName,
                    user_phone: customerPhone,
                    booking_date: date,
                    time_slots: timeSlots.join(', '),
                    total_hours: totalHours,
                    total_price: totalHours * 700, // Simple pricing - adjust as needed
                    status: 'confirmed' // Pre-bookings are confirmed by admin
                }]);

            if (!error) {
                successCount++;
            }
        }

        if (successCount > 0) {
            showNotification(`${successCount} bookings created successfully!`, 'success');
            closeModal('preBookingModal');
           
            loadConfirmedBookings();
        } else {
            showNotification('Failed to create bookings', 'error');
        }

    } catch (error) {
        console.error('Error creating bookings:', error);
        showNotification('Failed to create bookings', 'error');
    }
});

const turfModal = document.getElementById('turfModal');
const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
            if (turfModal.style.display === 'block') {
                generateCalendar(currentDate, 'calendarGrid', selectedDates);
            }
        }
    });
});
observer.observe(turfModal, { attributes: true });
    </script>
    </body>
    </html>
